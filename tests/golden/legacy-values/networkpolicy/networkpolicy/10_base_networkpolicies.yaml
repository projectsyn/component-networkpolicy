apiVersion: sync.appuio.ch/v1alpha1
kind: SyncConfig
metadata:
  annotations:
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
    syn.tools/source: https://github.com/projectsyn/component-networkpolicy.git
  labels:
    app.kubernetes.io/component: networkpolicy
    app.kubernetes.io/part-of: syn
    name: networkpolicies-base
  name: networkpolicies-base
  namespace: espejo
spec:
  namespaceSelector:
    ignoreNames:
      - my-ignored-namespace
    labelSelector:
      matchExpressions:
        - key: network-policies.syn.tools/base-defaults
          operator: Exists
  syncItems:
    - apiVersion: cilium.io/v2
      kind: CiliumNetworkPolicy
      metadata:
        annotations:
          syn.tools/source: https://github.com/projectsyn/component-networkpolicy.git
        labels:
          app.kubernetes.io/component: networkpolicy
          app.kubernetes.io/managed-by: espejo
          app.kubernetes.io/part-of: syn
          internal.network-policies.syn.tools/migration-mark-for-purge: 'true'
        name: allow-from-cluster-nodes
      spec:
        endpointSelector: {}
        ingress:
          - fromEntities:
              - host
          - fromNodes:
              - matchLabels:
                  syn.tools/cluster-id: c-green-test-1234
    - apiVersion: networking.k8s.io/v1
      kind: NetworkPolicy
      metadata:
        annotations:
          syn.tools/source: https://github.com/projectsyn/component-networkpolicy.git
        labels:
          app.kubernetes.io/component: networkpolicy
          app.kubernetes.io/managed-by: espejo
          app.kubernetes.io/part-of: syn
          internal.network-policies.syn.tools/migration-mark-for-purge: 'true'
          name: allow-from-other-namespaces
        name: allow-from-other-namespaces
      spec:
        ingress:
          - from:
              - namespaceSelector:
                  matchLabels:
                    test.example.net/test-group: main
        podSelector: {}
        policyTypes:
          - Ingress
